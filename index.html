<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session Question Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
            color: #333;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin: 5px 0;
        }
        .stat-label {
            color: #7f8c8d;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 160px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        #session-btn {
            background-color: #2ecc71;
        }
        #session-btn:hover {
            background-color: #27ae60;
        }
        #pause-btn {
            background-color: #f39c12;
        }
        #pause-btn:hover {
            background-color: #e67e22;
        }
        #solve-btn {
            background-color: #3498db;
            font-weight: bold;
            font-size: 18px;
            padding: 14px 24px;
        }
        #solve-btn:hover {
            background-color: #2980b9;
        }
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            margin: 25px 0;
        }
        .history-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .history-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        .history-item {
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        .history-item:hover {
            transform: translateX(5px);
        }
        .question-item {
            background-color: #f0f8ff;
            border-left: 4px solid #3498db;
        }
        .session-item {
            background-color: #f0fff4;
            border-left: 4px solid #2ecc71;
            margin-top: 15px;
        }
        .time-tag {
            background-color: #e3f2fd;
            color: #0d47a1;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .session-tag {
            background-color: #e8f5e9;
            color: #2e7d32;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .paused-tag {
            background-color: #fff8e1;
            color: #ff8f00;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .session-title {
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }
        .session-stats {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #555;
        }
        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 10px;
            width: 400px;
            max-width: 90%;
        }
        .modal-title {
            margin-top: 0;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        .tab-container {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        .tab.active {
            border-bottom: 3px solid #3498db;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .all-time-stats {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .all-time-stats h2 {
            margin-bottom: 20px;
        }
        .time-label {
            font-size: 12px;
            font-weight: bold;
            color: #555;
            text-align: center;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>Session Question Tracker</h1>
    <p>Track your problem solving efficiency across sessions</p>
    
    <div class="dashboard">
        <div class="stat-card">
            <div class="stat-value" id="total-questions">0</div>
            <div class="stat-label">Session Questions</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="total-time">0:00:00</div>
            <div class="stat-label">Session Time Spent</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="avg-time">0:00</div>
            <div class="stat-label">Avg Time</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="session-questions">0</div>
            <div class="stat-label">This Session</div>
        </div>
    </div>
    
    <div class="controls">
        <button id="solve-btn">Solved One! (Space)</button>
        <button id="pause-btn">Pause (P)</button>
        <button id="session-btn">Begin Session (S)</button>
    </div>
    
    <div class="tab-container">
        <div class="tab active" data-tab="time-distribution">Time Distribution</div>
        <div class="tab" data-tab="session-progress">Session Progress</div>
        <div class="tab" data-tab="all-time-distribution">All Time Distribution</div>
    </div>
    
    <div class="tab-content active" id="time-distribution">
        <div class="chart-container">
            <canvas id="timeDistributionChart"></canvas>
        </div>
    </div>
    
    <div class="tab-content" id="session-progress">
        <div class="chart-container">
            <canvas id="sessionProgressChart"></canvas>
        </div>
    </div>
    
    <div class="tab-content" id="all-time-distribution">
        <div class="chart-container">
            <canvas id="allTimeDistributionChart"></canvas>
        </div>
    </div>
    
    <div class="history-container">
        <div class="history-panel">
            <h3>Solving History</h3>
            <div id="question-history"></div>
        </div>
        <div class="history-panel">
            <h3>Session History</h3>
            <div id="session-history"></div>
        </div>
    </div>

    <div class="all-time-stats">
        <h2>All Time Statistics</h2>
        <div class="dashboard">
            <div class="stat-card">
                <div class="stat-value" id="all-time-total-questions">0</div>
                <div class="stat-label">Total Questions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="all-time-total-time">0:00:00</div>
                <div class="stat-label">Total Time Spent</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="all-time-avg-time">0:00</div>
                <div class="stat-label">Avg Time</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="all-time-session-count">0</div>
                <div class="stat-label">Total Sessions</div>
            </div>
        </div>
    </div>

    <div class="modal" id="session-modal">
        <div class="modal-content">
            <h3 class="modal-title">Name Your Session</h3>
            <div class="form-group">
                <label for="session-name">Session Name</label>
                <input type="text" id="session-name" placeholder="e.g. Leetcode Practice, Math Problems">
            </div>
            <div class="modal-actions">
                <button id="cancel-session">Cancel</button>
                <button id="save-session" style="background-color: #2ecc71;">Start Session</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const totalQuestionsEl = document.getElementById('total-questions');
        const totalTimeEl = document.getElementById('total-time');
        const avgTimeEl = document.getElementById('avg-time');
        const sessionQuestionsEl = document.getElementById('session-questions');
        const solveBtn = document.getElementById('solve-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const sessionBtn = document.getElementById('session-btn');
        const questionHistoryEl = document.getElementById('question-history');
        const sessionHistoryEl = document.getElementById('session-history');
        const timeCtx = document.getElementById('timeDistributionChart').getContext('2d');
        const sessionCtx = document.getElementById('sessionProgressChart').getContext('2d');
        const allTimeCtx = document.getElementById('allTimeDistributionChart').getContext('2d');
        const sessionModal = document.getElementById('session-modal');
        const sessionNameInput = document.getElementById('session-name');
        const cancelSessionBtn = document.getElementById('cancel-session');
        const saveSessionBtn = document.getElementById('save-session');
        const allTimeTotalQuestionsEl = document.getElementById('all-time-total-questions');
        const allTimeTotalTimeEl = document.getElementById('all-time-total-time');
        const allTimeAvgTimeEl = document.getElementById('all-time-avg-time');
        const allTimeSessionCountEl = document.getElementById('all-time-session-count');
        
        // Time buckets for histogram
        const timeBuckets = [
            '0-1 min', '1-2 min', '2-3 min', '3-4 min', 
            '4-5 min', '5-6 min', '6-7 min', '7-8 min', 
            '8-9 min', '9-10 min', '>10 min'
        ];
        
        // Initialize data
        let data = {
            allTimeQuestions: localStorage.getItem('allTimeQuestions') ? parseInt(localStorage.getItem('allTimeQuestions')) : 0,
            allTimeTime: localStorage.getItem('allTimeTime') ? parseInt(localStorage.getItem('allTimeTime')) : 0,
            timeDistribution: localStorage.getItem('timeDistribution') ? JSON.parse(localStorage.getItem('timeDistribution')) : Array(timeBuckets.length).fill(0),
            questionHistory: localStorage.getItem('questionHistory') ? JSON.parse(localStorage.getItem('questionHistory')) : [],
            sessionHistory: localStorage.getItem('sessionHistory') ? JSON.parse(localStorage.getItem('sessionHistory')) : [],
            currentSession: {
                active: false,
                paused: false,
                name: null,
                startTime: null,
                lastQuestionTime: null,
                pauseStartTime: null,
                questions: 0,
                timeSpent: 0,
                questionTimes: [],
                sessionTimeDistribution: Array(timeBuckets.length).fill(0),
                bucketTimes: Array(timeBuckets.length).fill(0) // Track time spent in each bucket
            },
            allTimeBucketTimes: Array(timeBuckets.length).fill(0) // Track all-time time in each bucket
        };
        
        // Time Distribution Chart (Current Session)
        let timeDistributionChart = new Chart(timeCtx, {
            type: 'bar',
            data: {
                labels: timeBuckets,
                datasets: [{
                    label: 'Number of Questions',
                    data: data.currentSession.sessionTimeDistribution,
                    backgroundColor: 'rgba(52, 152, 219, 0.7)',
                    borderColor: 'rgba(52, 152, 219, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Questions'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Time Taken per Question'
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'Question Time Distribution (Current Session)',
                        font: {
                            size: 16
                        }
                    },
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            afterLabel: function(context) {
                                const index = context.dataIndex;
                                const time = data.currentSession.bucketTimes[index];
                                return `Total time: ${formatShortTime(time)}`;
                            }
                        }
                    }
                }
            }
        });
        
        // All Time Distribution Chart
        let allTimeDistributionChart = new Chart(allTimeCtx, {
            type: 'bar',
            data: {
                labels: timeBuckets,
                datasets: [{
                    label: 'Number of Questions',
                    data: data.timeDistribution,
                    backgroundColor: 'rgba(155, 89, 182, 0.7)',
                    borderColor: 'rgba(155, 89, 182, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Questions'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Time Taken per Question'
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'Question Time Distribution (All Time)',
                        font: {
                            size: 16
                        }
                    },
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            afterLabel: function(context) {
                                const index = context.dataIndex;
                                const time = data.allTimeBucketTimes[index];
                                return `Total time: ${formatShortTime(time)}`;
                            }
                        }
                    }
                }
            }
        });
        
        // Session Progress Chart
        let sessionProgressChart = new Chart(sessionCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Questions per Session',
                        data: [],
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        tension: 0.1,
                        fill: true,
                        yAxisID: 'y'
                    },
                    {
                        label: 'Avg Time per Question',
                        data: [],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.1,
                        fill: true,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: {
                            display: true,
                            text: 'Questions Solved'
                        }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: {
                            display: true,
                            text: 'Avg Time (min)'
                        },
                        grid: {
                            drawOnChartArea: false,
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'Session Performance History',
                        font: {
                            size: 16
                        }
                    }
                }
            }
        });
        
        // Tab functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });
        
        // Initialize UI
        updateUI();
        updateCharts();
        updateHistory();
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && !data.currentSession.paused && data.currentSession.active) {
                e.preventDefault();
                solveQuestion();
            } else if (e.code === 'KeyP') {
                e.preventDefault();
                togglePause();
            } else if (e.code === 'KeyS') {
                e.preventDefault();
                toggleSession();
            }
        });
        
        // Event Listeners
        solveBtn.addEventListener('click', solveQuestion);
        pauseBtn.addEventListener('click', togglePause);
        sessionBtn.addEventListener('click', toggleSession);
        cancelSessionBtn.addEventListener('click', () => sessionModal.style.display = 'none');
        saveSessionBtn.addEventListener('click', startNewSession);
        
        // Main Functions
        function solveQuestion() {
            if (!data.currentSession.active || data.currentSession.paused) return;
            
            const now = new Date().getTime();
            
            // Calculate time since last question (or session start if first question)
            let timeSinceLast = 0;
            if (data.currentSession.questions > 0) {
                // If we were paused, only count time since pause was ended
                if (data.currentSession.pauseStartTime) {
                    timeSinceLast = (now - data.currentSession.pauseStartTime) / 1000;
                } else {
                    timeSinceLast = (now - data.currentSession.lastQuestionTime) / 1000;
                }
            } else {
                timeSinceLast = (now - data.currentSession.startTime) / 1000;
            }
            
            // Update data
            data.currentSession.questions++;
            data.currentSession.timeSpent += timeSinceLast;
            data.currentSession.questionTimes.push(timeSinceLast);
            data.currentSession.lastQuestionTime = now;
            data.currentSession.pauseStartTime = null;
            data.allTimeQuestions++;
            data.allTimeTime += timeSinceLast;
            
            // Add to history
            data.questionHistory.unshift({
                timestamp: now,
                timeSpent: timeSinceLast,
                sessionId: data.sessionHistory.length
            });
            
            // Update time distribution
            updateTimeDistribution(timeSinceLast);
            
            saveData();
            updateUI();
            updateCharts();
            updateHistory();
        }
        
        function updateTimeDistribution(timeInSeconds) {
            const minutes = Math.floor(timeInSeconds / 60);
            let bucketIndex;
            
            if (minutes < 1) bucketIndex = 0;
            else if (minutes >= 10) bucketIndex = 10;
            else bucketIndex = minutes;
            
            data.currentSession.sessionTimeDistribution[bucketIndex]++;
            data.currentSession.bucketTimes[bucketIndex] += timeInSeconds;
            
            data.timeDistribution[bucketIndex]++;
            data.allTimeBucketTimes[bucketIndex] += timeInSeconds;
        }
        
        function togglePause() {
            if (!data.currentSession.active) return;
            
            const now = new Date().getTime();
            
            if (data.currentSession.paused) {
                // Resume session
                data.currentSession.paused = false;
                data.currentSession.pauseStartTime = now; // Set pauseStartTime to now when resuming
                pauseBtn.textContent = 'Pause (P)';
                
                // Add resume marker to history
                data.questionHistory.unshift({
                    timestamp: now,
                    isResume: true,
                    sessionId: data.sessionHistory.length
                });
            } else {
                // Pause session - record pause start time
                data.currentSession.paused = true;
                data.currentSession.pauseStartTime = now;
                pauseBtn.textContent = 'Resume (P)';
                
                // Add pause marker to history
                data.questionHistory.unshift({
                    timestamp: now,
                    isPause: true,
                    sessionId: data.sessionHistory.length
                });
            }
            
            saveData();
            updateUI();
            updateHistory();
        }
        
        function toggleSession() {
            if (data.currentSession.active) {
                endSession();
            } else {
                sessionModal.style.display = 'flex';
                sessionNameInput.focus();
            }
        }
        
        function startNewSession() {
            const sessionName = sessionNameInput.value.trim() || `Session ${data.sessionHistory.length + 1}`;
            sessionModal.style.display = 'none';
            sessionNameInput.value = '';
            
            // Clear question history for new session
            data.questionHistory = [];
            
            // Start new session
            const now = new Date().getTime();
            data.currentSession = {
                active: true,
                paused: false,
                name: sessionName,
                startTime: now,
                lastQuestionTime: null,
                pauseStartTime: null,
                questions: 0,
                timeSpent: 0,
                questionTimes: [],
                sessionTimeDistribution: Array(timeBuckets.length).fill(0),
                bucketTimes: Array(timeBuckets.length).fill(0)
            };
            sessionBtn.textContent = 'End Session (S)';
            pauseBtn.disabled = false;
            
            // Add session start marker to history
            data.questionHistory.unshift({
                timestamp: now,
                isSessionStart: true,
                sessionId: data.sessionHistory.length
            });
            
            saveData();
            updateUI();
            updateCharts();
            updateHistory();
        }
        
        function endSession() {
            const now = new Date().getTime();
            
            if (!data.currentSession.paused && data.currentSession.lastQuestionTime) {
                // Add any remaining time if not paused
                const timeSinceLast = (now - data.currentSession.lastQuestionTime) / 1000;
                data.currentSession.timeSpent += timeSinceLast;
            }
            
            // Calculate session stats
            const avgTime = data.currentSession.questions > 0 
                ? data.currentSession.timeSpent / data.currentSession.questions 
                : 0;
            
            // Add to session history
            data.sessionHistory.unshift({
                name: data.currentSession.name,
                startTime: data.currentSession.startTime,
                endTime: now,
                questions: data.currentSession.questions,
                timeSpent: data.currentSession.timeSpent,
                avgTime: avgTime,
                questionTimes: data.currentSession.questionTimes
            });
            
            // Keep session history manageable
            if (data.sessionHistory.length > 20) {
                data.sessionHistory = data.sessionHistory.slice(0, 20);
            }
            
            // Add session end marker to history
            data.questionHistory.unshift({
                timestamp: now,
                isSessionEnd: true,
                sessionId: data.sessionHistory.length - 1,
                questions: data.currentSession.questions,
                timeSpent: data.currentSession.timeSpent
            });
            
            // Reset current session
            data.currentSession = {
                active: false,
                paused: false,
                name: null,
                startTime: null,
                lastQuestionTime: null,
                pauseStartTime: null,
                questions: 0,
                timeSpent: 0,
                questionTimes: [],
                sessionTimeDistribution: Array(timeBuckets.length).fill(0),
                bucketTimes: Array(timeBuckets.length).fill(0)
            };
            sessionBtn.textContent = 'Begin Session (S)';
            pauseBtn.disabled = true;
            
            saveData();
            updateUI();
            updateCharts();
            updateHistory();
        }
        
        function formatTime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            
            return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function formatShortTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        function formatDate(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }
        
        function updateUI() {
            // Update stats - now showing current session only
            const currentQuestions = data.currentSession.active ? data.currentSession.questions : 0;
            const currentTime = data.currentSession.active ? data.currentSession.timeSpent : 0;
            
            totalQuestionsEl.textContent = currentQuestions;
            totalTimeEl.textContent = formatTime(currentTime);
            sessionQuestionsEl.textContent = currentQuestions;
            
            // Calculate average time for current session
            const avgTimeSession = currentQuestions > 0 ? currentTime / currentQuestions : 0;
            
            avgTimeEl.textContent = formatShortTime(avgTimeSession);
            
            // Update all-time stats
            allTimeTotalQuestionsEl.textContent = data.allTimeQuestions;
            allTimeTotalTimeEl.textContent = formatTime(data.allTimeTime);
            allTimeSessionCountEl.textContent = data.sessionHistory.length;
            
            const avgTimeAll = data.allTimeQuestions > 0 ? data.allTimeTime / data.allTimeQuestions : 0;
            allTimeAvgTimeEl.textContent = formatShortTime(avgTimeAll);
            
            // Update button states
            solveBtn.disabled = !data.currentSession.active || data.currentSession.paused;
        }
        
        function updateCharts() {
            // Update time distribution chart with current session data only
            timeDistributionChart.data.datasets[0].data = data.currentSession.sessionTimeDistribution;
            timeDistributionChart.update();
            
            // Update all time distribution chart
            allTimeDistributionChart.data.datasets[0].data = data.timeDistribution;
            allTimeDistributionChart.update();
            
            // Update session progress chart (unchanged)
            const sessionLabels = data.sessionHistory.slice(0, 10).map(s => s.name);
            const sessionQuestions = data.sessionHistory.slice(0, 10).map(s => s.questions);
            const sessionAvgTimes = data.sessionHistory.slice(0, 10).map(s => s.avgTime / 60); // Convert to minutes
            
            sessionProgressChart.data.labels = sessionLabels.reverse();
            sessionProgressChart.data.datasets[0].data = sessionQuestions.reverse();
            sessionProgressChart.data.datasets[1].data = sessionAvgTimes.reverse();
            sessionProgressChart.update();
        }
        
        function updateHistory() {
            // Update question history - show all current session questions
            questionHistoryEl.innerHTML = '';
            data.questionHistory.slice(0, 50).forEach((item, index) => {
                const entry = document.createElement('div');
                
                if (item.isSessionStart) {
                    entry.className = 'history-item session-item';
                    const session = data.sessionHistory[item.sessionId] || { name: 'Current Session' };
                    entry.innerHTML = `
                        <div>
                            <div class="session-title">
                                <span>${session.name}</span>
                                <span class="session-tag">Started</span>
                            </div>
                            <div>${formatDate(item.timestamp)}</div>
                        </div>
                    `;
                } else if (item.isSessionEnd) {
                    entry.className = 'history-item session-item';
                    const session = data.sessionHistory[item.sessionId] || { name: 'Previous Session' };
                    entry.innerHTML = `
                        <div>
                            <div class="session-title">
                                <span>${session.name}</span>
                                <span class="session-tag">Completed</span>
                            </div>
                            <div class="session-stats">
                                <span class="stat">${item.questions} questions</span>
                                <span class="stat">${formatShortTime(item.timeSpent)} total</span>
                                <span class="stat">${formatShortTime(item.timeSpent/item.questions)} avg</span>
                            </div>
                            <div>${formatDate(item.timestamp)}</div>
                        </div>
                    `;
                } else if (item.isPause) {
                    entry.className = 'history-item session-item';
                    entry.innerHTML = `
                        <div>
                            <div class="session-title">
                                <span>Session Paused</span>
                                <span class="paused-tag">Paused</span>
                            </div>
                            <div>${formatDate(item.timestamp)}</div>
                        </div>
                    `;
                } else if (item.isResume) {
                    entry.className = 'history-item session-item';
                    entry.innerHTML = `
                        <div>
                            <div class="session-title">
                                <span>Session Resumed</span>
                                <span class="session-tag">Resumed</span>
                            </div>
                            <div>${formatDate(item.timestamp)}</div>
                        </div>
                    `;
                } else {
                    entry.className = 'history-item question-item';
                    const timeTag = document.createElement('span');
                    timeTag.className = 'time-tag';
                    timeTag.textContent = formatShortTime(item.timeSpent);
                    
                    const questionNumber = document.createElement('span');
                    questionNumber.textContent = `Q${index + 1}`;
                    
                    const timeText = document.createElement('span');
                    timeText.textContent = formatDate(item.timestamp);
                    
                    entry.appendChild(questionNumber);
                    entry.appendChild(timeTag);
                    entry.appendChild(timeText);
                }
                
                questionHistoryEl.appendChild(entry);
            });
            
            // Update session history (unchanged)
            sessionHistoryEl.innerHTML = '';
            data.sessionHistory.slice(0, 10).forEach((session, index) => {
                const entry = document.createElement('div');
                entry.className = 'history-item session-item';
                
                const avgTime = session.questions > 0 ? session.timeSpent / session.questions : 0;
                
                entry.innerHTML = `
                    <div>
                        <div class="session-title">
                            <span>${session.name || `Session ${data.sessionHistory.length - index}`}</span>
                            <span class="time-tag">${formatShortTime(session.timeSpent)}</span>
                        </div>
                        <div class="session-stats">
                            <span class="stat">${session.questions} questions</span>
                            <span class="stat">${formatShortTime(avgTime)} avg</span>
                            <span>${formatDate(session.startTime)}</span>
                        </div>
                    </div>
                `;
                
                sessionHistoryEl.appendChild(entry);
            });
            
            if (data.sessionHistory.length === 0) {
                sessionHistoryEl.innerHTML = '<p>No sessions recorded yet.</p>';
            }
        }
        
        function saveData() {
            localStorage.setItem('allTimeQuestions', data.allTimeQuestions);
            localStorage.setItem('allTimeTime', data.allTimeTime);
            localStorage.setItem('timeDistribution', JSON.stringify(data.timeDistribution));
            localStorage.setItem('questionHistory', JSON.stringify(data.questionHistory));
            localStorage.setItem('sessionHistory', JSON.stringify(data.sessionHistory));
            localStorage.setItem('allTimeBucketTimes', JSON.stringify(data.allTimeBucketTimes));
        }
    </script>
</body>
</html>
